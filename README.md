# 遗传病突变位点全球分布看板 - 技术开发说明

本项目旨在建立一个可视化的交互式看板，展示 ClinVar 数据库中致病突变在全球不同人群（基于 gnomAD 数据库）中的频率分布情况。

## 1. 开发思路

整个开发过程分为四个核心阶段：

### 阶段一：原始数据采集与清洗 (ClinVar)
- **目标**：获取所有标注为“致病”或“可能致病”的人类突变位点。
- **操作**：从公共数据库（如 ClinVar）下载原始变异数据，提取关键字段：RSID (dbSNP ID)、基因符号 (Gene Symbol)、变异名称、临床意义以及关联的遗传病名称 (Phenotype)。
- **去重逻辑**：保留 RSID，但由于一个突变可能关联多种遗传病，我们保留了这种“多对多”的对应关系，以便用户搜索不同疾病时都能找到该变异。

### 阶段二：频率数据补全 (gnomAD API)
- **目标**：为采集到的 RSID 匹配全球八大主要人群的等位基因频率 (AF)。
- **操作**：编写自动化脚本，调用 MyVariant.info API，针对缺失频率的 RSID 进行批量异步抓取。
- **挑战**：由于数据量巨大（数十万条），脚本实现了**断点续传**和**后台执行**功能，确保在网络波动或计算机休眠时任务不中断。

### 阶段三：数据清洗与终极合并
- **目标**：将致病变异信息与人群频率信息完美融合。
- **操作**：
    1. 对抓取的频率数据进行去重，确保每个 RSID 只有一套最准确的人群频率。
    2. 执行 `Left Join` 合并，将频率数据附加到致病变异列表中。
    3. 确保合并后的数据结构能够支撑“疾病-变异”的关联展示。

### 阶段四：前端看板可视化
- **目标**：提供直观的搜索和地图展示界面。
- **技术栈**：使用 Python Streamlit 框架构建 Web UI，结合 Plotly 实现全球地理分布的热点图。

---

## 2. 目录文件说明

目前资源管理器中保留的文件及其作用如下：

### 代码文件
- **[app.py](file:///data/wyw/app.py)**: **【核心程序】** 交互式看板的主程序。负责加载最终数据、处理用户搜索逻辑以及渲染全球分布地图。
- **[step2_fetch_missing.py](file:///data/wyw/step2_fetch_missing.py)**: **【数据补全工具】** 专门用于从网络 API 抓取缺失 RSID 频率数据的工具脚本。
- **[step3_final_process.py](file:///data/wyw/step3_final_process.py)**: **【数据整合工具】** 负责将离线的 ClinVar 列表与抓取到的频率数据进行最终的清洗、去重和合并。

### 数据文件
- **[final_variant_data.csv](file:///data/wyw/final_variant_data.csv)**: **【最终数据库】** 经过所有清洗合并步骤后生成的最终文件。看板直接从此文件读取数据，包含了完整的突变信息和全球频率，是整个项目的“心脏”。

---

## 3. 如何分享与使用

### 启动看板
在服务器终端运行：
```bash
streamlit run app.py
```

### 如何分享给他人使用
1. **获取网络地址**：启动后，终端会显示 `Network URL: http://<您的服务器IP>:8501`。
2. **分享链接**：将该链接发送给您的同事。只要他们在同一局域网内（或者服务器具有公网 IP 且防火墙开放了 8501 端口），即可通过浏览器直接访问。
3. **后台常驻**：如果您希望关闭终端后网页依然可用，请使用：
   `nohup streamlit run app.py > streamlit.log 2>&1 &`
